# Analysis-of-NJ-RAT-Infection-Logs-and-Implementation-of-Detection-Rules-using-Suricata
NJ RAT ê°ì—¼ ë¡œê·¸ ë¶„ì„ ë° Suricata íƒì§€ ê·œì¹™ êµ¬í˜„ ë° ì‹œì—°

> ê°ì—¼íŒŒì¼ ì¶œì²˜ : https://www.joesandbox.com/analysis/844872/0/html

<hr>

## ğŸ“¡ C2 Master ë° Agent ì •ë³´ ìš”ì•½

| í•­ëª©             | ê°’ |
|------------------|--------------------------------------------------------|
| Master IP ê°œìˆ˜    | 3ê°œ |
| Master IP ëª©ë¡    | 52.28.247.255, 3.69.115.178, 3.68.171.119, 3.69.157.220 |
| Agent IP ê°œìˆ˜     | 1ê°œ |
| Agent IP ëª©ë¡     | 192.168.2.4 |

---

## ğŸ”„ ì–‘ì ê°„ í†µì‹  ë°ì´í„° ì „ì†¡ ë¶„ì„

| í”„ë ˆì„ ë²ˆí˜¸ | ì†¡ì‹ ì§€ â†’ ìˆ˜ì‹ ì§€              | ë°ì´í„° í¬ê¸° (Bytes) | ê³µí†µ ë°ì´í„° ë‚´ìš© (Hex/ASCII)                       |
|-------------|-------------------------------|----------------------|---------------------------------------------------|
| #79         | 192.168.2.4 â†’ 52.28.247.255   | 150                  | 4E 4A 2D 52 41 54 (NJ-RAT Signature)              |
| #81         | 192.168.2.4 â†’ 52.28.247.255   | 160                  | C2 ëª…ë ¹ ì´ˆê¸° íŒ¨í‚· (AESë¡œ ì•”í˜¸í™”ëœ ëª…ë ¹)           |
| #83         | 192.168.2.4 â†’ 52.28.247.255   | 35                   | Beacon ë©”ì‹œì§€ ì „ì†¡ ì‹œë„                           |
| #85         | 52.28.247.255 â†’ 192.168.2.4   | 4                    | í™•ì¸ ì‘ë‹µ, AES ì•”í˜¸í™”ëœ ëª…ë ¹ í¬í•¨                |
| #93         | 192.168.2.4 â†’ 3.69.115.178    | 150                  | ë™ì¼ êµ¬ì¡°ì˜ íŒ¨í‚·, NJRAT ì´ˆê¸° í•¸ë“œì‰ì´í¬           |
| #95         | 192.168.2.4 â†’ 3.69.115.178    | 160                  | ë™ì¼í•œ C2 ì‘ë‹µ íŒ¨í„´ (AES or ì»¤ìŠ¤í…€ ì§ë ¬í™”)       |
| #97         | 3.69.115.178 â†’ 192.168.2.4    | 35                   | ë™ì¼ êµ¬ì¡°ì˜ íŒ¨í‚·, NJRAT ì´ˆê¸° í•¸ë“œì‰ì´í¬           |
'''
| #151        | 192.168.2.4 â†’ 3.68.171.119    | 150                  | ë™ì¼í•œ C2 ì‘ë‹µ íŒ¨í„´ (AES or ì»¤ìŠ¤í…€ ì§ë ¬í™”)       |
| #153        | 192.168.2.4 â†’ 3.68.171.119    | 160                  | ë™ì¼í•œ C2 ì‘ë‹µ íŒ¨í„´ (AES or ì»¤ìŠ¤í…€ ì§ë ¬í™”)       |
| #155        | 192.168.2.4 â†’ 3.68.171.119    | 35                   | ë™ì¼ êµ¬ì¡°ì˜ íŒ¨í‚·, NJRAT ì´ˆê¸° í•¸ë“œì‰ì´í¬           |
| #157        | 192.168.2.4 â†’ 3.68.171.119    | 15                   | ë™ì¼í•œ C2 ì‘ë‹µ íŒ¨í„´ (AES or ì»¤ìŠ¤í…€ ì§ë ¬í™”)       |
| #159        | 192.168.2.4 â†’ 3.68.171.119    | 35                   | ë™ì¼í•œ C2 ì‘ë‹µ íŒ¨í„´ (AES or ì»¤ìŠ¤í…€ ì§ë ¬í™”)       |
'''
| #203        | 192.168.2.4 â†’ 3.69.157.220    | 130                  | ë™ì¼ êµ¬ì¡°ì˜ íŒ¨í‚·, NJRAT ì´ˆê¸° í•¸ë“œì‰ì´í¬           |
| #205        | 192.168.2.4 â†’ 3.69.157.220    | 160                  | ë™ì¼í•œ C2 ì‘ë‹µ íŒ¨í„´ (AES or ì»¤ìŠ¤í…€ ì§ë ¬í™”)       |
| #207        | 192.168.2.4 â†’ 3.69.157.220    | 35                  | ë™ì¼í•œ C2 ì‘ë‹µ íŒ¨í„´ (AES or ì»¤ìŠ¤í…€ ì§ë ¬í™”)       |

# ê°œìš” 

1. ë¶„ì„ ëª©ì  : NJ RAT ê°ì—¼ ì§•í›„ ë° í”¼í•´ì‚¬í•­ ì¶”ì¶œ
2. ë¶„ì„ ëŒ€ìƒ : PACAP File
3. RAT ì¢…ë¥˜ ë° ë²„ì „ : NJ RAT
4. ì‚¬ìš©ëœ ë¶„ì„ ë„êµ¬ : Suricata, Wireshark

# NJ RAT

| í•­ëª©       | ë‚´ìš©                                                                 |
|------------|----------------------------------------------------------------------|
| **ëª…ì¹­**   | NJRat (ë˜ëŠ” Bladabindi)                                              |
| **ë¶„ë¥˜**   | Remote Access Trojan (RAT)                                           |
| **ì¶œì‹œ ì‹œì ** | 2013ë…„ê²½ ê³µê°œ, ì´í›„ ì—¬ëŸ¬ ë²„ì „ ë“±ì¥                                  |
| **ê¸°ë°˜ ì–¸ì–´** | .NET (VB.NET)                                                      |
| **ìš©ë„**   | ì›ê²© ì œì–´, í‚¤ë¡œê¹…, íŒŒì¼ ë‹¤ìš´ë¡œë“œ/ì—…ë¡œë“œ, ì›¹ìº  ì ‘ê·¼ ë“±                 |

<br>

# íŠ¹ì§•
- ìŠ¤íŒ¸ ì´ë©”ì¼, USB ì „íŒŒ, ì•…ì„± í¬ë™íˆ´, ë“œë¼ì´ë¸Œ ë°”ì´ ë‹¤ìš´ë¡œë“œ
- Visual Basic ê¸°ë°˜ ë¹Œë”ë¡œ ì†ì‰½ê²Œ C2 ì„¤ì • ë° ì•…ì„±ì½”ë“œ ìƒì„± ê°€ëŠ¥
- ì¤‘ë™ ë° ë‚¨ì•„ì‹œì•„ ì§€ì—­ì—ì„œ ë‹¤ìˆ˜ ë°œê²¬
- êµìœ¡ê¸°ê´€, ì •ë¶€ê¸°ê´€, ì¤‘ì†Œê¸°ì—… ë“± íƒ€ê¹ƒ
- ì˜¤í”ˆì†ŒìŠ¤ë¡œ í¼ì¡Œê¸° ë•Œë¬¸ì— ìŠ¤í¬ë¦½íŠ¸ í‚¤ë””ì˜ ì…ë¬¸ìš©ìœ¼ë¡œë„ ë§ì´ ì‚¬ìš©ë¨
- í† ë ŒíŠ¸ ë° ì›¹í•˜ë“œë¥¼ í†µí•œ ìœ í¬

<hr>

# ë¶„ì„

![image](https://github.com/user-attachments/assets/1a5d7670-d05b-4bf0-a4de-73e43c736ee7)

- í•´ë‹¹ íŒ¨í‚·ì„ ë³´ê²Œë˜ë©´ 192.168.2.4 ë‚´ë¶€ ì‚¬ì„¤ë§ IP ì™€ì˜ ì—¬ëŸ¬ í†µì‹ ì‹œë„ê°€ ì‹ë³„ë¨, ë˜í•œ ì£¼ê³ ë°›ëŠ” ë°ì´í„°ì˜ í¬ê¸°ê°€ ì¼ì •í•œ ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŒ.
- ì¼ì •í•˜ê²Œ ë‚˜íƒ€ë‚˜ëŠ” ë°ì´í„°ì˜ í¬ê¸°ëŠ” 150, 160, 35, 4, 130 ë¡œ í™•ì¸ë¨

> ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì„ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ Base64ë¡œ ì¸ì½”ë”© ëœ ë¬¸ìì—´ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```
146.ll|'|'|SFVTQlBfQzBCNkM3Njc=|'|'|065367|'|'|jones|'|'|23-04-11|'|'||'|'|Win 10 ProSP0 x64|'|'|No|'|'|im523|'|'|..|'|'|UHJvZ3JhbSBNYW5hZ2VyAA==|'|'|156.inf|'|'|SFVTQlANCjYudGNwLmV1Lm5ncm9rLmlvOjE5OTA1DQpEZXNrdG9wDQpnQXRyTzM0b3RlLmV4ZQ0KRmFsc2UNCkZhbHNlDQpGYWxzZQ0KRmFsc2UNCkZhbHNlDQpGYWxzZQ0KRmFsc2UNCkZhbHNl32.act|'|'|UHJvZ3JhbSBNYW5hZ2VyAA==
```
Base64ë¡œ ì¸ì½”ë”©ëœ ê°’ì„ ë³µí˜¸í™” í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ì¶œë ¥ê°’ì„ ì–»ê²Œ ëœë‹¤.

```
×!UM	A}Ó®w68]V}t>?Lz"Program Managerï¿½
y)HUSBP
6.tcp.eu.ngrok.io:19905
Desktop
gAtrO34ote.exe
False
False
False
False
False
False
False
FalsefAÉ½É…5ï¿½
```

í•´ë‹¹ ë‚´ìš©ì„ ë³´ë©´ 6.tcp.eu.ngrok.io:19905 ì™€ ê°™ì€ ì£¼ì†Œì™€ í¬íŠ¸ê°€ ë³´ì´ë©° ê²½ë¡œì™€ íŒŒì¼ ê·¸ë¦¬ê³  ê²°ê³¼ê°’ìœ¼ë¡œ ë³´ì´ëŠ” ë¬¸ìì—´ë“¤ì´ ì¶œë ¥ëœë‹¤.
<br>

![image](https://github.com/user-attachments/assets/fad78d77-6969-4eb9-97a7-ae44e26583ff)

ì‹¤ì œ í•´ë‹¹ ì£¼ì†Œë¥¼ Virus Totalì„ í†µí•´ í™•ì¸í•´ë³´ë©´ Maliciousë¡œ ì¶œë ¥ëœë‹¤.

1. 52.28.247.255  | ![image](https://github.com/user-attachments/assets/56b1cb75-9bfb-4c19-b445-95a8e5ade8b5)
2. 3.69.115.178 | ![image](https://github.com/user-attachments/assets/09714a73-4e5a-4dab-a483-18d3fb07fad1)
3. 3.68.171.119 | ![image](https://github.com/user-attachments/assets/b79ab7e5-76d0-4edb-9fc9-fa752202e69c)

ì‹¤ì œë¡œ 3ê°œì˜ IPì „ë¶€ Malware IP ë¡œ í™•ì¸ë˜ì—ˆë‹¤.

![image](https://github.com/user-attachments/assets/d99f6d6a-d54f-4b84-b5b4-48579fb2871f)

- DNS íŒ¨í‚·ì„ í™•ì¸í•´ë³´ë©´ ì´ì „ì— Base64 ë””ì½”ë”© ê²°ê³¼ê°’ì—ì„œ í™•ì¸ëœ Malicious ì£¼ì†Œë¡œ ì§ˆì˜/ì‘ë‹µì„ ì§„í–‰í•œ íŒ¨í‚·ì´ í™•ì¸ëœë‹¤.

### 4 len packet

![image](https://github.com/user-attachments/assets/d1f75fa5-5b62-4b65-9b8c-e5f67454910d)

4ë°”ì´íŠ¸ì˜ ë°ì´í„°ëŠ” ë‹¨ìˆœ 0d0a ì¦‰, ê°œí–‰ì„ ë‚˜íƒ€ë‚´ëŠ” íŒ¨í‚·ìœ¼ë¡œ í™•ì¸ë˜ë©°ã€ ì´ëŠ” ëª…ë ¹ ë° ì—°ê²° ì¢…ë£Œë¡œ ì¶”ì •ëœë‹¤ã€‚

## ğŸ” Packet 1~3 Hex Dump ë¹„êµ (150 Byte)

| Offset | Packet 1                                             | Packet 2                                             | Packet 3                                             |
|--------|------------------------------------------------------|------------------------------------------------------|------------------------------------------------------|
| 0000   |<span style="color:red"> 00 0c 29 82 cb 33 ec f4 bb ea 15 88 08 00 45 00       | <span style="color:red">00 0c 29 82 cb 33 ec f4 bb ea 15 88 08 00 45 00       | <span style="color:red">00 0c 29 82 cb 33 ec f4 bb ea 15 88 08 00 45 00       |
| 0010   | 00 be</span> 25 a7 40 00 80 06 e5 ca c0 a8 02 04 34 1c       | 00 be</sapn> 27 93 40 00 80 06 99 03 c0 a8 02 04 03 45       | 00 be</sapn> 27 9b 40 00 80 06 98 fb c0 a8 02 04 03 45       |
| 0020   | f7 ff c2 1f 4d c1 b7 69 4d b1 f1 04 3e b1 50 18       | 73 b2 c2 20 4d c1 c0 0b 02 73 3a 99 76 80 50 18       | 73 b2 c2 21 4d c1 f9 a5 c8 d9 bf 5e 02 0b 50 18       |


---

### ğŸ”¹ Packet 4 (160 Byte)

| Offset | Hex Dump |
|--------|----------|
| 0000 | 00 0c 29 82 cb 33 ec f4 bb ea 15 88 08 00 45 00 |
| 0010 | 00 c8 27 94 40 00 80 06 98 c0 c0 a8 02 04 03 45 |
| 0020 | 73 b2 c2 20 4d c1 c0 0b 03 09 3a 99 76 80 50 18 |

---

### ğŸ”¹ Packet 5 (160 Byte)

| Offset | Hex Dump |
|--------|----------|
| 0000 | 00 0c 29 82 cb 33 ec f4 bb ea 15 88 08 00 45 00 |
| 0010 | 00 c8 27 9c 40 00 80 06 98 c8 c0 a8 02 04 03 45 |
| 0020 | 73 b2 c2 21 4d c1 f9 a5 c9 6f bf 5e 02 0b 50 18 |

---

### ğŸ”¹ Packet 6 (160 Byte)

| Offset | Hex Dump |
|--------|----------|
| 0000 | 00 0c 29 82 cb 33 ec f4 bb ea 15 88 08 00 45 00 |
| 0010 | 00 c8 25 af 40 00 80 06 e5 b8 c0 a8 02 04 34 1c |
| 0020 | f7 ff c2 22 4d c1 9f 92 d1 62 75 c0 a4 cb 50 18 |





